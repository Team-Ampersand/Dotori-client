name: Dotori Client CI

on:
  push:
    branches: [ "feature/cicd" ]
  pull_request:
    branches: [ "feature/cicd" ]

jobs:

  build:
    runs-on: ubuntu-latest

    steps:
    - name: Create .env
      run: 
        echo "GENERATE_SOURCEMAP=${{GENERATE_SOURCEMAP}}" >> .env
        echo "REACT_APP_NEIS_API_KEY=${{REACT_APP_NEIS_API_KEY}}" >> .env
        echo "REACT_APP_FIREBASE_API_KEY=${{REACT_APP_FIREBASE_API_KEY}}" >> .env
        echo "REACT_APP_FIREBASE_AUTH_DOMAIN=${{REACT_APP_FIREBASE_AUTH_DOMAIN}}" >> .env
        echo "REACT_APP_FIREBASE_PROJECT_ID=${{REACT_APP_FIREBASE_PROJECT_ID}}" >> .env
        echo "REACT_APP_FIREBASE_STORAGE_BUCKET=${{REACT_APP_FIREBASE_STORAGE_BUCKET}}" >> .env
        echo "REACT_APP_FIREBASE_MESSAGING_SENDER_ID=${{REACT_APP_FIREBASE_MESSAGING_SENDER_ID}}" >> .env
        echo "REACT_APP_FIREBASE_APP_ID=${{REACT_APP_FIREBASE_APP_ID}}" >> .env
        echo "REACT_APP_FIREBASE_MEASUREMENT_ID=${{REACT_APP_FIREBASE_MEASUREMENT_ID}}" >> .env
        echo "REACT_APP_YOUTUBE_API_KEY=${{REACT_APP_YOUTUBE_API_KEY}}" >> .env
        cat .env
      # env:
      #     ENV: $({secrets.ENV})

    - name: Checkout source code.   # Repo checkout
      uses: actions/checkout@v2
      
    - name: Check Node v            # Node v í™•ì¸
      run: node -v

    - name: Install Dependencies    # ì˜ì¡´ íŒŒì¼ ì„¤ì¹˜
      run: yarn install --frozen-lockfile

    - name: Build                   # React Build
      run: yarn build

    - name: Dotori Client CI Success Discord Notification
      uses: sarisia/actions-status-discord@v1
      if: ${{ success() }}
      with:
        title: ğŸ‰ Dotori Client CI ğŸ¿
        webhook: ${{ secrets.DISCORD_WEBHOOK }}
        color: 00FF00
    - name: Dotori Client CI Fail Discord Notification
      uses: sarisia/actions-status-discord@v1
      if: ${{ failure() }}
      with:
        title: âŒ Dotori Client CI ğŸ¿
        webhook: ${{ secrets.DISCORD_WEBHOOK }}
        color: FF0000